# VIEW

- SQL の観点から見ると、ビューは「テーブルと同じもの」
  - テーブルの中には実際のデータが保存される
  - VIEW にはセレクト文が保存される
  - 実際にデータが保存されているのか否かが唯一の違い
- 必要なデータが複数のテーブルにまたがる場合などの複雑な集約を楽に行う事ができる
- よく使う SELECT 文を VIEW にしておくことで使いまわせる
- CREATE VIEW : VIEW を作成
- DROP VIEW : VIEW を作成
- 制限事項
  - ORDER BY 句は使えない
  - ビューに対する更新は不可能ではないが制限がある

## 通常のデータハンドリング

- データベースのデータが実際どこに保存されるかというと、コンピューター内の記憶デバイスに保存される（INSERT 文でデータを格納）
- SLECT 文でデータを検索する際は実際にはこのハードディスクからデータを引っ張り出して計算を行い、ユーザーに計算を返す

## VIEW のデータハンドリング

- データを記憶装置に保存しない。
- ビューからデータを取り出そうとするとき、ビューは内部的にその SELECT 文を実行して一時的に仮想のテーブルを作る

## VIEW のメリット

大きく分けて二つ

1. 記憶装置の容量を節約できる（データを保存しないため）
2. 頻繁に使う SELECT をいちいち書いておかなくてもビューとして保存しておくことで使いまわせる
   集計や条件が複雑になる程メリットがある

- ビューが含むデータは元テーブルと連動して自動的に最新の状態に更新される（SELECT だから）

## 構文

```sql
CREATE VIEW [NAME] AS SELECT ...
```

## VIEW に対する検索

ビューを FROM 句に指定したときの検索

1. 最初にビューに定義された SELECT 文を実行
2. その結果に対して、ビューを FROM 句に指定した SELECT が実行される

## 多段 VIEW

- ビューに対する検索では常に２つ以上の SELECT が実行される
- ビューをもとにさらにビューを作ることもできる（多段ビュー）
  - 構造上は認められているが、なるべく避けること
  - パフォーマンス低下を招く
  - 極力一段で止めるのがベター

## ビューの制限事項

1. ビュー定義で ORDER BY は使えない
   - テーブルと同様、行には順序がないと考えられているため
   - できる DBMS もあるが標準ではない
2. ビューに対する更新
   - ビュー定義の SELECT においていくつかの条件を満たしている場合 VIEW に対する更新が可能
     1. SELECT に DISTINCT が含まれていない
     2. FROM 句に含まれるテーブルが一つだけ
     3. GROUP BY, HAVING を使用していない
