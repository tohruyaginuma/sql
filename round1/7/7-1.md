# 集合演算

- UNION
- INTERSECT
- EXCEPT

## 下準備

```sql
-- DDL
CREATE TABLE Shohin2
(
    shohin_id   CHAR(4) NOT NULL,
    shohin_mei   VARCHAR(100) NOT NULL,
    shohin_bunrui  VARCHAR(32) NOT NULL,
    hanbai_tanka   INTEGER ,
    shiire_Tanka   INTEGER ,
    torokubi   DATE ,
    PRIMARY KEY (shohin_id)
);

-- DML
BEGIN TRANSACTION;

INSERT INTO Shohin2 VALUES('0001', ' Tシャツ', '衣服', 1000, 500, '2008-09-20');
INSERT INTO Shohin2 VALUES('0002', ' 穴あけパンチ', '事務用品', 500, 320, '2008-09-11');
INSERT INTO Shohin2 VALUES('0003', ' カッターシャツ', '衣服', 4000, 2800, NULL);
INSERT INTO Shohin2 VALUES('0009', ' 手袋', '衣服', 800, 500, NULL);
INSERT INTO Shohin2 VALUES('0010', ' やかん', 'キッチン用品', 2000, 1700, '2008-09-20');

COMMIT;
```

## UNION -- ２つのテーブルの和集合を表示

- テーブルの足し算
- 和集合が出力される
- 集合演算子は重複行を排除する

```sql
SELECT shohin_id, shohin_mei
FROM Shohin
UNION
SELECT shohin_id, shohin_mei
FROM Shohin2;
```

- 注意点
  - 演算対象となるレコードの列名は同じであること
  - 足し算対象の列のデータ型が一致していること、CAST でも対応可能ではある
  - SELECT の項目に制限はない、ORDER BY は最後に一つだけつけること
  - `ALL`: UNION はディフォルトでは重複を削除するが、ALL で残す
    - UNION 以外でも使える演算子
    ```sql
    SELECT shohin_id, shohin_mei
    FROM Shohin
    UNION ALL
    SELECT shohin_id, shohin_mei
    FROM Shohin2;
    ```

## INTERSECT -- テーブルの共通部分のみの選択

- 交差
- レコード集合の共通部分を選択する
- ALL 使える

```sql
SELECT shohin_id, shohin_mei
FROM Shohin
INTERSECT
SELECT shohin_id, shohin_mei
FROM Shohin2
ORDER BY shohin_id;
```

## EXCEPT -- レコードの引き算

- 共通していない部分を表示。
- 最初の SELECT に対して後の SELECT をひく

```sql
SELECT shohin_id, shohin_mei
FROM Shohin
EXCEPT
SELECT shohin_id, shohin_mei
FROM Shohin2
ORDER BY shohin_id;
```
