# 色々な関数

- 算術関数
  - 数値の計算を行う関数
- 文字列関数
  - 文字列操作を行う関数
- 日付関数
  - 日付の操作を行う関数
- 変換関数
  - データ型や値を変換する関数
- 集約関数
  - データの集計を行う関数
- よく使うのだけ覚えて、あとは必要になったら調べるイメージで良い
- 200 以上ある
- 暗記する必要はない。知って使うときにリファレンスする

## 算術関数

- `+, - , /, *`　こちらも含まれる

### `NUMERIC`：型、数値の大きさを指定。

- `NUMERIC(全体の桁数（最大の桁数）、少数の桁数（ディフォルトで入る小数点）)`

```sql
-- DDL
CREATE TABLE SampleMath
(
    m NUMERIC   (10,3),
    n INTEGER,
    p INTEGER
);

-- DML
BEGIN TRANSACTION;

INSERT INTO SampleMath(m, n, p) VALUES (500, 0, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (-180, 0, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, NULL, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 7, 3);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 5, 2);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 4, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (8, NULL, 3);
INSERT INTO SampleMath(m, n, p) VALUES (2.27, 1, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (5.555, 2, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 1, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (8.75, NULL, NULL);

COMMIT;
```

### ABS(数値)

- 絶対値を求める関数
- 絶対値：０からの距離

```sql
SELECT m,
        ABS(m) AS abs_col
FROM SampleMath;
```

### MOD(被除数, 除数)

- 割り算のあまりを求める関数
- Modulo
- MOD(7/3) = 1
- 「あまり」とは整数の概念なので Float などでは利用できない

```sql
SELECT n, p,
    MOD(n, p) AS mod_col
FROM SampleMath;
```

### ROUND(対象数, 丸桁数)

- 四捨五入

```sql
SELECT m, n,
    ROUND(m, n) AS round_col
FROM SampleMath;
```

## 文字列関数

-

```sql
-- DDL
CREATE TABLE SampleStr
(
    str1    VARCHAR(40),
    str2    VARCHAR(40),
    str3    VARCHAR(40)
);

-- DML
BEGIN TRANSACTION;

INSERT INTO SampleStr(str1, str2, str3) VALUES ('あいう', 'えお', NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('abc', 'def', NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('山田', '太郎', NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('aaa', NULL, NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES (NULL, 'あああ', NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('@!#$%', NULL, NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('ABC', NULL, NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('aBC', NULL, NULL);
INSERT INTO SampleStr(str1, str2, str3) VALUES ('abc太郎', 'abc', 'ABC');
INSERT INTO SampleStr(str1, str2, str3) VALUES ('ミックマック', 'ッ', 'っ');

UPDATE SampleStr SET str3 = 'デス' WHERE str1 = '山田';

COMMIT;
```

### 連結

`文字列１ || 文字列2`

```sql
SELECT str1, str2,
    str1 || str2 AS str_concat
FROM SampleStr;

SELECT str1, str2, str3,
    str1 || str2 || str3 AS str_concat
FROM SampleStr
WHERE str1 = '山田';
```

### LENGTH 文字列長

- DBMS によってはバイト数をカウントする関数
- また LEN など、DBMS によって Dialect も違う

```sql
SELECT str1,
LENGTH(str1) AS len_str
FROM SampleStr;
```

### その他

一般的なプログラミングランゲージと同じなのでリストだけ記載する

- LOWER 小文字化
- UPPER 大文字化
- REPLACE 置換
- SUBSTRING 文字列切り出し

## 日付関数

- CURRENT_DATE: 関数が実行された日付を返す。引数なし
- CURRENT_TIME: 関数が実行された時間を返す。
- CURRENT_TIMESTAMP: 現在の日時
- EXTRACT(): 日付要素の切り出し。日付データの一部分を切り出し
  ```sql
  SELECT CURRENT_TIMESTAMP,
  EXTRACT(YEAR  FROM CURRENT_TIMESTAMP) AS year;
  ```

## 変換関数

「変換」SQL の文脈においては２つの意味

1. データ型の変換、型変換、キャスト

```sql
CAST(... AS ...)
```

2. 値の変換

### COALESCE /koʊˈæl.s/（コウ・アレス）

- NULL を値へ変換する

```sql
SELECT COALESCE(NULL, 1) AS col_1,
  COALESCE(NULL, 'test', NULL) AS col_2,
  COALESCE(NULL, NULL, '2009-11-01') AS col_1;
```
